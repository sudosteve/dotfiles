#!/bin/sh

# Prints all batteries, their percentage remaining and an emoji corresponding
# to charge status (ğŸ”Œ for plugged up, ğŸ”‹ for discharging on battery, etc.).

data=$(razer-rs -b | grep charg | awk '{print $2}')
[ -n "$data" ] || exit

battery_file=~/.local/state/last_mouse_battery_capacity
[ -f "$battery_file" ] || echo 100 > $battery_file
last_capacity=$(cat $battery_file)

case $BLOCK_BUTTON in
    3) notify-send "ğŸ–± Mouse battery module" \
"ğŸ”Œ: charging\nâ—: battery very low!" ;;
esac

# When mouse goes idle, this will falsely report charge as 0
capacity=$(echo $data | awk '{print $1}')
[ "$capacity" = 0 ] && capacity=$last_capacity

charging=$(echo $data | awk '{print $2}')
[[ "$charging" = [tT]rue ]] && icon="ğŸ”Œ"

# If it is discharging and 25% or less, we will add a â— as a warning.
[ "$capacity" -le 25 ] && [ "$charging" = "False" ] && icon="â—"

# If battery is too low, send notification to user
[ "$capacity" -le 10 ] && [ "$last_capacity" -gt 10 ] && \
    notify-send "ğŸ”‹ Battery low â—"
[ "$capacity" -le 5 ] && [ "$last_capacity" -gt 5 ] && \
    notify-send "ğŸ”‹ Battery low â—"
echo $capacity > $battery_file

printf 'ğŸ–± %s%% %s\n' "$capacity" "$icon"
#sed s/\ $/\\n/
